<!DOCTYPE html>
<html>
	<head>
		<title>A logging app using Node.js</title>
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" >
		<script
			  src="https://code.jquery.com/jquery-3.1.1.min.js"
			  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
			  crossorigin="anonymous"></script>
		<script src = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" ></script>
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" >
	
 	</head>


	<body>
		<div class = "container">
		    <div style="padding:10px;" class = "jumbotron">

		    	<h2>Sample Node.js Application</h2><br />
		    		<div class = "row">
		    			<a id="home" loc="index.html" href="javascript:void(0);"><div style="background-color:#e9573f;margin-left: 5px;color:black;" class = "col-md-2 col-sm-2 col-xs-2"><h4>Home</h4></div></a>
		    			<a loc="contact.html" href="javascript:void(0)"><div style="background-color:#e9573f;margin-left: 2px;color:black;" class = "col-md-2 col-sm-2 col-xs-2"><h4>Contact</h4></div></a>
		    			<a loc="plans.html" href="javascript:void(0)"><div style="background-color:#e9573f;margin-left: 2px;color:black;" class = "col-md-2 col-sm-2 col-xs-2"><h4>Plans</h4></div></a>
		    			<a loc="aboutus.html" href="javascript:void(0)"><div style="background-color:#e9573f;margin-left: 2px;color:black;" class = "col-md-2 col-sm-2 col-xs-2"><h4>About Us</h4></div></a>
		    		</div>
		    </div>
		    <div style="padding:50px" class="well">
		    	<div class="row">
		    		<div class="well col-md-4">
		    		<div style="text-align:center"><h3>Article 1</h3></div>
		    		Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas volutpat massa vel sapien posuere euismod. Aenean neque turpis, consequat eu cursus quis, congue vitae sem. Donec scelerisque eu odio id pellentesque. Sed consectetur, eros sit amet feugiat dapibus, mi elit porttitor risus, eget laoreet ante lorem eget dolor. Duis posuere sit amet sem et porttitor. Maecenas mollis nisl risus, et scelerisque ante rhoncus id. Morbi finibus in urna et mattis. Integer quis efficitur sem, ut tempor sem. Phasellus dapibus cursus mi pellentesque laoreet. Quisque ultricies lacus elit, quis ornare nisi iaculis vel. Sed metus orci, convallis non suscipit nec, viverra eget turpis. Aliquam euismod ac orci nec imperdiet. Fusce venenatis purus sit amet lorem fringilla semper.<br /><br />
		    		<button type="button" loc='article1.html' label = "Article 1 on home page" class="btn btn-danger col-md-4 col-md-offset-4 loggable">More > </button>
		    		</div>
		    		<div class="well col-md-4">
		    		<div style="text-align:center"><h3>Article 2</h3></div>
		    		Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas volutpat massa vel sapien posuere euismod. Aenean neque turpis, consequat eu cursus quis, congue vitae sem. Donec scelerisque eu odio id pellentesque. Sed consectetur, eros sit amet feugiat dapibus, mi elit porttitor risus, eget laoreet ante lorem eget dolor. Duis posuere sit amet sem et porttitor. Maecenas mollis nisl risus, et scelerisque ante rhoncus id. Morbi finibus in urna et mattis. Integer quis efficitur sem, ut tempor sem. Phasellus dapibus cursus mi pellentesque laoreet. Quisque ultricies lacus elit, quis ornare nisi iaculis vel. Sed metus orci, convallis non suscipit nec, viverra eget turpis. Aliquam euismod ac orci nec imperdiet. Fusce venenatis purus sit amet lorem fringilla semper.
		    		<br /><br />
		    		<button type="button" loc='article2.html' label = "Article 2 on home page" class="btn btn-danger col-md-4 col-md-offset-4 loggable">More > </button>
		    		</div>
		    		<div class="well col-md-4">
		    		<div style="text-align:center"><h3>Article 3</h3></div>
		    		Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas volutpat massa vel sapien posuere euismod. Aenean neque turpis, consequat eu cursus quis, congue vitae sem. Donec scelerisque eu odio id pellentesque. Sed consectetur, eros sit amet feugiat dapibus, mi elit porttitor risus, eget laoreet ante lorem eget dolor. Duis posuere sit amet sem et porttitor. Maecenas mollis nisl risus, et scelerisque ante rhoncus id. Morbi finibus in urna et mattis. Integer quis efficitur sem, ut tempor sem. Phasellus dapibus cursus mi pellentesque laoreet. Quisque ultricies lacus elit, quis ornare nisi iaculis vel. Sed metus orci, convallis non suscipit nec, viverra eget turpis. Aliquam euismod ac orci nec imperdiet. Fusce venenatis purus sit amet lorem fringilla semper.
		    		<br /><br />
		    		<button type="button" loc='article3.html' label = "Article 3 on page" class="btn btn-danger col-md-4 col-md-offset-4 loggable">More > </button>
		    		</div>
		    	</div>
		    	<hr />
		    	<div class="row">
		    		<h4>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas volutpat massa vel sapien posuere euismod. Aenean neque turpis, consequat eu cursus quis, congue vitae sem. Donec scelerisque eu odio id pellentesque. </h4>
		    		<button type="button" loc = "plans.html" label = "Plans button in home page" class="btn btn-danger col-md-2 col-md-offset-5 loggable">See Plans > </button>
		    	</div>
		    	<hr />
		    	<br /><br />
		    	<div class="row">
		    	<button id="showdata" type="button" class="btn btn-danger col-md-4 col-md-offset-4">Show activites from this IP</button>
		    	</div>
		    </div>

		    <div id="myModal" class="modal fade" role="dialog">
			  <div class="modal-dialog">

			    <!-- Modal content-->
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal">&times;</button>
			        <h4 class="modal-title">Activity logs</h4>
			      </div>
			      <div class="modal-body">
			        <ul id="ins">
			        	
			        </ul>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			      </div>
			    </div>

			  </div>
			</div>

		</div>

		<script>
			$(document).ready(function(){

				
				//alert("jquery works");s
				var ipaddr;
				$('a').hover(function(){
					//alert("yes");
					$(this).children().css('color','white');
				}).mouseleave(function(){
					$(this).children().css('color','black');
				});

				$('a').click(function(){
					var clicktxt = $(this).text();
					var page = $(this).attr('loc');
					sendipinfo(clicktxt,page);
					
				});

				$('.loggable').click(function(){
						var clicktxt = $(this).attr('label');
						var page = $(this).attr('loc');
						sendipinfo(clicktxt,page);
				});



				function tojson(ip,txt,page){
				var dataSample = {
						  "user": 
						    {
						      "ip": ip,
						      "time": new Date(),
						      "method": "POST",
						      "description":"User has clicked "+txt
						    }
						  
						}

						$.ajax({
  						  	url: '/postlogs', 
						    type: 'POST', 
						    contentType: 'application/json', 
						    data: JSON.stringify(dataSample),
						    success: function(data) {
						    	console.log("sucess");
					            window.location.href = page;
					             }
						});

				}

				function sendipinfo(txt,page){
					$.get("http://ipinfo.io", function (response) {
							//alert(response.ip);
							console.log(response);

							
							tojson(response.ip,txt,page);
							

		    				}, "jsonp");
				}
				function getipinfo(purpose){
					
							$.get("http://ipinfo.io", function (response) {
							//alert(response.ip);
							console.log(response);

							if(purpose === "get"){
								hitip(response.ip);
							}

		    				}, "jsonp");
				}

				function hitip(ip){
					ipaddr = ip;
					//alert(ipaddr);
					$.get('/getlogs',{"ip":ip}, function (data) {
						//alert(data);
   					 console.log(data);
   					 //var showJson = JSON.parse(data);
   					 var i=0;
   					 for(i=0;i<data.user.length;i++){
   					 	$('#ins').append('<li>'+data.user[i].ip+" | "+data.user[i].time+" | "+data.user[i].method+" | "+data.user[i].description+'</li>');
   					 }
   					 $('#myModal').modal('show');
   						
  					});
				}

    			
				$('#showdata').click(function(){

					 
  					getipinfo("get");


    			    
				});

			});

		</script>

	</body>


</html>
